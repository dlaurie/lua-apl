/*
** lctype-utf8.c
** 'ctype' functions for Lua allowing UTF-8 codepoints in names
**      -- full explanation at bottom
** See Copyright Notice in lua.h
** patched from $Id: lctype.c,v 1.11 2011/10/03 16:19:23 roberto Exp $
** by Dirk Laurie 2013
*/

#define lctype_c
#define LUA_CORE

#include "lctype.h"

#if !LUA_USE_CTYPE	/* { */

#include <limits.h>

LUAI_DDEF const lu_byte luai_ctype_[UCHAR_MAX + 2] = {
  0x00,  /* EOZ */
  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,	/* 0. */
  0x00,  0x08,  0x08,  0x08,  0x08,  0x08,  0x00,  0x00,
  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,	/* 1. */
  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
  0x0c,  0x04,  0x04,  0x04,  0x04,  0x04,  0x04,  0x04,	/* 2. */
  0x04,  0x04,  0x04,  0x04,  0x04,  0x04,  0x04,  0x04,
  0x16,  0x16,  0x16,  0x16,  0x16,  0x16,  0x16,  0x16,	/* 3. */
  0x16,  0x16,  0x04,  0x04,  0x04,  0x04,  0x04,  0x04,
  0x04,  0x15,  0x15,  0x15,  0x15,  0x15,  0x15,  0x05,	/* 4. */
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,	/* 5. */
  0x05,  0x05,  0x05,  0x04,  0x04,  0x04,  0x04,  0x05,
  0x04,  0x15,  0x15,  0x15,  0x15,  0x15,  0x15,  0x05,	/* 6. */
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,	/* 7. */
  0x05,  0x05,  0x05,  0x04,  0x04,  0x04,  0x04,  0x00,
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,	/* 8. */
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,	/* 9. */
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,	/* a. */
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,	/* b. */
  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,  0x06,
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,	/* c. */
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,	/* d. */
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,	/* e. */
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,	/* f. */
  0x05,  0x05,  0x05,  0x05,  0x05,  0x05,  0x00,  0x00,
};

/* UTF-8 codepoints have a header byte between 0xC0 and 0xFD, and follow-up
 * bytes between 0x80 and 0xBF. The total number of bytes equals the number
 * of leading ones in the first byte. 
 *
 * The above patch allows Lua names containing UTF-8 codepoints by declaring 
 * the byte range 0xC0-0xFD alphabetic and 0x80-0xBF numeric. 
 *
 * It does not check that enough follow-up bytes are given or that 
 * follow-up bytes appear only inside the scope of a header byte. Thus it 
 * accepts some strings that would not be valid UTF-8. All that is promised 
 * is that valid UTF-8 sequences may appear anywhere in Lua names.
 */

#endif			/* } */

